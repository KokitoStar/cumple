<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <title>Tatuajes Kokito - Beneficio de Cumpleaños</title>
    <meta name="description" content="Celebra tu cumpleaños con Tatuajes Kokito. Registrate y recibe un tatuaje gratis en tu día especial.">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom CSS -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap');
        
        :root {
            --kokito-purple-primary: #a855f7;
            --kokito-purple-light: #e9d5ff;
            --kokito-purple-dark: #7c3aed;
            --kokito-pink: #ec4899;
            --kokito-success: #059669;
            --kokito-error: #dc2626;
            --kokito-info: #0284c7;
            --kokito-warning: #ff8c00;
            --kokito-text-primary: #1f2937;
            --kokito-text-secondary: #6b7280;
        }
        
        /* Ensure proper rendering on all devices */
        * {
            box-sizing: border-box;
        }

        html {
            background: #1a1a2e;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
            background-attachment: fixed;
            background-repeat: no-repeat;
            background-size: cover;
            min-height: 100%;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: transparent;
            min-height: 100vh;
            min-height: 100dvh; /* For mobile browsers */
            color: var(--kokito-text-primary);
            position: relative;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            html {
                background-attachment: scroll; /* Better performance on mobile */
            }
            
            body {
                background: #1a1a2e;
                background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
            }
            
            .glitter-container {
                display: none; /* Disable particles on mobile for better performance */
            }
        }

        .glitter-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
            z-index: -1;
        }

        .glitter-container::before,
        .glitter-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(2px 2px at 20px 30px, #ffd700, transparent),
                radial-gradient(2px 2px at 40px 70px, #ffffff, transparent),
                radial-gradient(1px 1px at 90px 40px, #ffd700, transparent),
                radial-gradient(1px 1px at 130px 80px, #ffffff, transparent),
                radial-gradient(2px 2px at 160px 30px, #ffd700, transparent);
            background-repeat: repeat;
            background-size: 200px 100px;
            animation: glitter 4s linear infinite;
            will-change: transform; /* Optimize for animations */
        }

        .glitter-container::after {
            background-image: 
                radial-gradient(1px 1px at 60px 20px, #ffffff, transparent),
                radial-gradient(2px 2px at 110px 50px, #ffd700, transparent),
                radial-gradient(1px 1px at 170px 90px, #ffffff, transparent),
                radial-gradient(2px 2px at 10px 60px, #ffd700, transparent),
                radial-gradient(1px 1px at 80px 10px, #ffffff, transparent);
            animation: glitter 6s linear infinite reverse;
            will-change: transform; /* Optimize for animations */
        }

        @keyframes glitter {
            0% { transform: translateX(-200px); }
            100% { transform: translateX(200px); }
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--kokito-purple-primary) 0%, var(--kokito-pink) 50%, var(--kokito-success) 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(168, 85, 247, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(168, 85, 247, 0.4);
        }

        .btn-secondary {
            background: transparent;
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .form-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 14px 16px;
            color: white;
            width: 100%;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--kokito-purple-primary);
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .hidden {
            display: none !important;
        }

        .logo-mobile {
            width: 120px;
            height: auto;
        }

        .logo-desktop {
            width: 220px;
            height: auto;
        }

        @media (max-width: 768px) {
            .logo-desktop {
                width: 120px;
            }
        }

        .main-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            min-height: 100dvh;
        }

        /* Additional mobile fixes */
        @media (max-width: 768px) {
            .main-container {
                padding: 15px;
            }
            
            .glass-card {
                margin: 10px 0;
            }
            
            /* Ensure proper spacing on mobile */
            .min-h-screen {
                min-height: 100vh;
                min-height: 100dvh;
            }
        }

        /* Fallback background for older browsers */
        .fallback-bg {
            background: #1a1a2e !important;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        .terms-section {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
        }

        .age-warning {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
        }
    </style>
</head>
<body>
    <div class="glitter-container"></div>
    
    <div class="main-container">
        <!-- Welcome Page -->
        <div id="welcome-page" class="min-h-screen flex flex-col items-center justify-center text-center text-white">
            <div class="glass-card p-8 w-full max-w-md">
                <img id="main-logo" src="./LOGO_KOKITO.svg" alt="Kokito Logo" class="logo-desktop mx-auto mb-6 cursor-pointer">
                
                <h1 class="text-3xl font-bold mb-4 bg-gradient-to-r from-purple-400 via-pink-400 to-green-400 bg-clip-text text-transparent">
                    🎉 ¡Celebra tu Cumpleaños con Nosotros! 🎉
                </h1>
                
                <p class="text-lg mb-6 text-gray-300">
                    Regístrate y recibe un <strong>tatuaje completamente GRATIS</strong> en tu día especial
                </p>
                
                <div class="terms-section mb-6">
                    <h3 class="text-sm font-semibold text-purple-400 mb-2">📋 Condiciones del Beneficio:</h3>
                    <ul class="text-xs text-gray-300 space-y-1 text-left">
                        <li>• Válido solo en un rango de 8 días antes y 8 días después de tu cumpleaños</li>
                        <li>• Edad mínima: 1 año cumplido</li>
                        <li>• Válido únicamente por un tatuaje</li>
                        <li>• Pase intransferible</li>
                        <li>• Presentar pase junto con documento de identidad</li>
                        <li>• No acumulable con otras promociones</li>
                        <li>• Solo válido en Tatuajes Kokito</li>
                    </ul>
                </div>
                
                <button onclick="showRegistration()" class="btn-primary mb-4 w-full">
                    🎂 Quiero mi Tatuaje Gratis
                </button>
                
                <p class="text-sm text-gray-400">
                    ¿Ya tienes tu pase? Solo llama al tatuador con tu número registrado
                </p>
            </div>
        </div>

        <!-- Registration Page -->
        <div id="registration-page" class="min-h-screen flex flex-col items-center justify-center text-white hidden">
            <div class="glass-card p-8 w-full max-w-md">
                <img src="./LOGO_KOKITO.svg" alt="Kokito Logo" class="logo-desktop mx-auto mb-6">
                
                <h2 class="text-2xl font-bold mb-6 text-center">Registro para Beneficio</h2>
                
                <form id="registration-form" class="space-y-4">
                    <div>
                        <input type="text" id="name" placeholder="Tu nombre completo" class="form-input" required>
                    </div>
                    
                    <div>
                        <input type="tel" id="phone" placeholder="Número de teléfono (ej: 3001234567)" class="form-input" required>
                    </div>

                    <div>
                        <input type="email" id="email" placeholder="Correo electrónico" class="form-input" required>
                    </div>
                    
                    <div>
                        <input type="date" id="birthDate" class="form-input" required>
                        <label class="text-sm text-gray-400 mt-1 block">Fecha de nacimiento</label>
                        <div class="age-warning">
                            <p class="text-yellow-200 text-xs">
                                ⚠️ Recuerda: Solo puedes registrarte si tu cumpleaños está dentro de los próximos 8 días o ya pasó hace máximo 8 días
                            </p>
                        </div>
                    </div>
                    
                    <div>
                        <input type="text" id="collaboratorCode" placeholder="Código de colaborador (opcional)" class="form-input">
                        <p class="text-xs text-gray-400 mt-1">Si te invitó un colaborador, ingresa su código aquí</p>
                    </div>
                    
                    <div class="terms-section">
                        <h3 class="text-sm font-semibold text-purple-400 mb-2">📋 Términos y Condiciones:</h3>
                        <div class="text-xs text-gray-300 space-y-1 text-left max-h-32 overflow-y-auto">
                            <p>• <strong>Elegibilidad:</strong> Edad mínima 1 año cumplido</p>
                            <p>• <strong>Período válido:</strong> 8 días antes y 8 días después del cumpleaños</p>
                            <p>• <strong>Beneficio:</strong> Válido únicamente por un tatuaje</p>
                            <p>• <strong>Transferibilidad:</strong> Pase intransferible</p>
                            <p>• <strong>Identificación:</strong> Presentar documento de identidad junto al pase</p>
                            <p>• <strong>Exclusividad:</strong> No acumulable con otras promociones</p>
                            <p>• <strong>Validez:</strong> Solo en Tatuajes Kokito</p>
                            <p>• <strong>Responsabilidad:</strong> El estudio se reserva el derecho de verificar la información</p>
                        </div>
                        <label class="flex items-start mt-3">
                            <input type="checkbox" id="acceptTerms" class="mt-1 mr-2" required>
                            <span class="text-xs text-gray-300">Acepto los términos y condiciones del beneficio de cumpleaños</span>
                        </label>
                    </div>
                    
                    <button type="submit" class="btn-primary w-full">
                        🎁 Registrarme Ahora
                    </button>
                </form>
                
                <button onclick="showWelcome()" class="btn-secondary w-full mt-4">
                    ← Volver
                </button>
            </div>
        </div>

        <!-- Confirmation Page -->
        <div id="confirmation-page" class="min-h-screen flex flex-col items-center justify-center text-white hidden">
            <div class="glass-card p-8 w-full max-w-md text-center">
                <img src="./LOGO_KOKITO.svg" alt="Kokito Logo" class="logo-desktop mx-auto mb-6">
                
                <div class="text-6xl mb-4">🎉</div>
                <h2 class="text-2xl font-bold mb-4">¡Registro Exitoso!</h2>
                
                <div id="pass-info" class="bg-black/30 p-4 rounded-lg mb-6">
                    <p class="text-sm text-gray-300 mb-2">Tu pase digital:</p>
                    <div id="pass-details" class="text-white font-mono text-sm"></div>
                </div>
                
                <div class="bg-green-600/20 border border-green-600/30 rounded-lg p-4 mb-6">
                    <p class="text-green-200 text-sm text-center">
                        <strong>📱 ¡Captura esta pantalla!</strong><br>
                        Guarda una foto de este pase para presentarlo en el estudio junto con tu documento de identidad
                    </p>
                </div>
                
                <div class="bg-yellow-600/20 border border-yellow-600/30 rounded-lg p-4 mb-4">
                    <p class="text-yellow-200 text-sm">
                        <strong>Importante:</strong><br>
                        • Guarda tu pase y preséntalo junto con tu cédula<br>
                        • Solo válido en el rango de fechas indicado<br>
                        • Válido únicamente por un tatuaje<br>
                        • Pase intransferible
                    </p>
                </div>
                
                <button onclick="showWelcome()" class="btn-secondary w-full">
                    ← Volver al Inicio
                </button>
            </div>
        </div>

        <!-- Staff Page -->
        <div id="staff-page" class="min-h-screen flex flex-col items-center justify-center text-white hidden">
            <div class="glass-card p-8 w-full max-w-md">
                <img src="./LOGO_KOKITO.svg" alt="Kokito Logo" class="logo-desktop mx-auto mb-6 cursor-pointer" onclick="handleStaffLogoClick()">
                
                <h2 class="text-2xl font-bold mb-6 text-center">Panel de Staff</h2>
                
                <div class="bg-black/30 p-4 rounded-lg mb-6">
                    <div class="text-center">
                        <div class="text-3xl font-bold text-green-400" id="today-redemptions">0</div>
                        <div class="text-sm text-gray-400">Canjes de hoy</div>
                    </div>
                </div>
                
                <div class="space-y-4 mb-6">
                    <input type="tel" id="search-phone" placeholder="Buscar por teléfono" class="form-input">
                    <button onclick="searchPassByPhone()" class="btn-primary w-full">
                        🔍 Buscar Pase
                    </button>
                </div>
                
                <div id="pass-result" class="hidden bg-black/30 p-4 rounded-lg mb-4">
                    <div id="customer-info"></div>
                    <button onclick="redeemPass()" class="btn-primary w-full mt-3">
                        ✅ Canjear Pase
                    </button>
                </div>
                
                <button onclick="showWelcome()" class="btn-secondary w-full">
                    ← Volver al Inicio
                </button>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="admin-page" class="min-h-screen flex flex-col items-center justify-center text-white hidden">
            <div class="glass-card p-8 w-full max-w-4xl">
                <img src="./LOGO_KOKITO.svg" alt="Kokito Logo" class="logo-desktop mx-auto mb-6">
                
                <h2 class="text-2xl font-bold mb-6 text-center">Panel de Administración</h2>
                
                <!-- Stats Overview -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-green-600/20 border border-green-600/30 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-green-400" id="total-active">0</div>
                        <div class="text-sm text-gray-400">Pases Activos</div>
                    </div>
                    <div class="bg-blue-600/20 border border-blue-600/30 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-blue-400" id="total-redeemed">0</div>
                        <div class="text-sm text-gray-400">Pases Redimidos</div>
                    </div>
                    <div class="bg-yellow-600/20 border border-yellow-600/30 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-yellow-400" id="total-expired">0</div>
                        <div class="text-sm text-gray-400">Pases Expirados</div>
                    </div>
                </div>

                <!-- Filter Tabs -->
                <div class="flex space-x-2 mb-6">
                    <button onclick="filterPasses('all')" class="btn-secondary text-sm" id="filter-all">Todos</button>
                    <button onclick="filterPasses('active')" class="btn-secondary text-sm" id="filter-active">Activos</button>
                    <button onclick="filterPasses('redeemed')" class="btn-secondary text-sm" id="filter-redeemed">Redimidos</button>
                    <button onclick="filterPasses('expired')" class="btn-secondary text-sm" id="filter-expired">Expirados</button>
                </div>

                <!-- Passes List -->
                <div class="bg-black/30 rounded-lg p-4 max-h-96 overflow-y-auto mb-6">
                    <div id="passes-list" class="space-y-3">
                        <!-- Passes will be dynamically loaded here -->
                    </div>
                </div>
                
                <div class="flex space-x-4">
                    <button onclick="exportData()" class="btn-primary">
                        📊 Exportar Datos
                    </button>
                    <button onclick="showStaff()" class="btn-secondary">
                        ← Volver a Staff
                    </button>
                    <button onclick="logout()" class="btn-secondary">
                        🚪 Cerrar Sesión
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Modal -->
    <div id="loading-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="glass-card p-6 text-center text-white">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4"></div>
            <p>Procesando...</p>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast glass-card p-4 text-white">
        <div class="flex items-center">
            <div id="toast-icon" class="mr-3 text-xl"></div>
            <div>
                <div id="toast-title" class="font-semibold"></div>
                <div id="toast-message" class="text-sm opacity-90"></div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentPass = null;
        let logoClickCount = 0;
        let logoClickTimer = null;
        let allPasses = []; // Store all passes for staff view
        let isAuthenticated = false;

        // Set default date to today
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            const birthDateInput = document.getElementById('birthDate');
            if (birthDateInput) {
                birthDateInput.value = formattedDate;
            }
            
            // Fix mobile background issues
            fixMobileBackground();
            
            // Also fix on window load for additional safety
            window.addEventListener('load', fixMobileBackground);
            window.addEventListener('resize', fixMobileBackground);
        });

        // Fix mobile background rendering
        function fixMobileBackground() {
            // Check if we're on mobile
            const isMobile = window.innerWidth <= 768 || /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            // Force background for all devices to ensure consistency
            const html = document.documentElement;
            const body = document.body;
            
            // Set background on both html and body
            const bgColor = '#1a1a2e';
            const bgGradient = 'linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%)';
            
            html.style.background = bgColor;
            html.style.backgroundImage = bgGradient;
            body.style.background = bgColor;
            body.style.backgroundImage = bgGradient;
            
            if (isMobile) {
                // Additional mobile fixes
                html.style.backgroundAttachment = 'scroll';
                body.style.backgroundAttachment = 'scroll';
                
                // Disable particles for better performance
                const glitterContainer = document.querySelector('.glitter-container');
                if (glitterContainer) {
                    glitterContainer.style.display = 'none';
                }
            }
            
            // Force repaint
            setTimeout(() => {
                body.style.transform = 'translateZ(0)';
                setTimeout(() => {
                    body.style.transform = '';
                }, 50);
            }, 100);
        }

        // Date validation functions
        function isWithinBirthdayRange(birthDate) {
            const today = new Date();
            const birth = new Date(birthDate);
            
            // Create dates with current year for comparison
            const currentYearBirthday = new Date(today.getFullYear(), birth.getMonth(), birth.getDate());
            
            // Calculate the date range (8 days before and after)
            const startRange = new Date(currentYearBirthday);
            startRange.setDate(startRange.getDate() - 8);
            
            const endRange = new Date(currentYearBirthday);
            endRange.setDate(endRange.getDate() + 8);
            
            // Check if today is within the range
            return today >= startRange && today <= endRange;
        }

        function calculateAge(birthDate) {
            const today = new Date();
            const birth = new Date(birthDate);
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            
            return age;
        }

        function getBirthdayRangeText(birthDate) {
            const birth = new Date(birthDate);
            const today = new Date();
            const currentYearBirthday = new Date(today.getFullYear(), birth.getMonth(), birth.getDate());
            
            const startRange = new Date(currentYearBirthday);
            startRange.setDate(startRange.getDate() - 8);
            
            const endRange = new Date(currentYearBirthday);
            endRange.setDate(endRange.getDate() + 8);
            
            return `${startRange.toLocaleDateString('es-ES')} - ${endRange.toLocaleDateString('es-ES')}`;
        }

        // Navigation functions
        function showWelcome() {
            document.getElementById('welcome-page').classList.remove('hidden');
            document.getElementById('registration-page').classList.add('hidden');
            document.getElementById('confirmation-page').classList.add('hidden');
            document.getElementById('staff-page').classList.add('hidden');
            document.getElementById('admin-page').classList.add('hidden');
        }

        function showRegistration() {
            document.getElementById('welcome-page').classList.add('hidden');
            document.getElementById('registration-page').classList.remove('hidden');
            document.getElementById('confirmation-page').classList.add('hidden');
            document.getElementById('staff-page').classList.add('hidden');
            document.getElementById('admin-page').classList.add('hidden');
        }

        function showConfirmation() {
            document.getElementById('welcome-page').classList.add('hidden');
            document.getElementById('registration-page').classList.add('hidden');
            document.getElementById('confirmation-page').classList.remove('hidden');
            document.getElementById('staff-page').classList.add('hidden');
            document.getElementById('admin-page').classList.add('hidden');
        }

        function showStaff() {
            document.getElementById('welcome-page').classList.add('hidden');
            document.getElementById('registration-page').classList.add('hidden');
            document.getElementById('confirmation-page').classList.add('hidden');
            document.getElementById('staff-page').classList.remove('hidden');
            document.getElementById('admin-page').classList.add('hidden');
            loadStats();
        }

        function showAdmin() {
            document.getElementById('welcome-page').classList.add('hidden');
            document.getElementById('registration-page').classList.add('hidden');
            document.getElementById('confirmation-page').classList.add('hidden');
            document.getElementById('staff-page').classList.add('hidden');
            document.getElementById('admin-page').classList.remove('hidden');
            loadAdminData();
        }

        // Logo click handler for staff access
        function handleLogoClick() {
            logoClickCount++;
            
            if (logoClickTimer) {
                clearTimeout(logoClickTimer);
            }
            
            logoClickTimer = setTimeout(() => {
                logoClickCount = 0;
            }, 2000);
            
            if (logoClickCount === 3) {
                logoClickCount = 0;
                clearTimeout(logoClickTimer);
                showStaff();
            }
        }

        // Staff logo click handler for admin access
        function handleStaffLogoClick() {
            logoClickCount++;
            
            if (logoClickTimer) {
                clearTimeout(logoClickTimer);
            }
            
            logoClickTimer = setTimeout(() => {
                logoClickCount = 0;
            }, 2000);
            
            if (logoClickCount === 3) {
                logoClickCount = 0;
                clearTimeout(logoClickTimer);
                requestAuthentication();
            }
        }

        // Authentication function
        function requestAuthentication() {
            const password = prompt('Ingresa el código de administrador:');
            if (password === '8357565') {
                isAuthenticated = true;
                showAdmin();
                showToast('Acceso concedido', 'Bienvenido al panel de administración', 'success');
            } else if (password !== null) {
                showToast('Acceso denegado', 'Código incorrecto', 'error');
            }
        }

        // Logout function
        function logout() {
            isAuthenticated = false;
            showStaff();
            showToast('Sesión cerrada', 'Has salido del panel de administración', 'info');
        }

        // Utility functions
        function showLoading() {
            document.getElementById('loading-modal').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loading-modal').classList.add('hidden');
        }

        function showToast(title, message, type = 'success') {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toast-icon');
            const titleEl = document.getElementById('toast-title');
            const messageEl = document.getElementById('toast-message');
            
            const icons = {
                success: '✅',
                error: '❌',
                warning: '⚠️',
                info: 'ℹ️'
            };
            
            icon.textContent = icons[type];
            titleEl.textContent = title;
            messageEl.textContent = message;
            
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 5000);
        }

        // Registration form handler
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('registration-form');
            if (form) {
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const formData = {
                        name: document.getElementById('name').value.trim(),
                        phone: document.getElementById('phone').value.trim(),
                        email: document.getElementById('email').value.trim(),
                        birthDate: document.getElementById('birthDate').value,
                        collaboratorCode: document.getElementById('collaboratorCode').value.trim(),
                        acceptTerms: document.getElementById('acceptTerms').checked
                    };
                    
                    // Basic validation
                    if (!formData.name || !formData.phone || !formData.email || !formData.birthDate) {
                        showToast('Error', 'Por favor completa todos los campos obligatorios', 'error');
                        return;
                    }

                    if (!formData.acceptTerms) {
                        showToast('Error', 'Debes aceptar los términos y condiciones', 'error');
                        return;
                    }
                    
                    // Email validation
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(formData.email)) {
                        showToast('Error', 'Ingresa un correo electrónico válido', 'error');
                        return;
                    }

                    // Age validation
                    const age = calculateAge(formData.birthDate);
                    if (age < 1) {
                        showToast('Error', 'La edad mínima para el beneficio es 1 año cumplido', 'error');
                        return;
                    }

                    // Birthday range validation
                    if (!isWithinBirthdayRange(formData.birthDate)) {
                        showToast('Error', 'Solo puedes registrarte dentro del rango de 8 días antes y 8 días después de tu cumpleaños', 'warning');
                        return;
                    }

                    // Check if phone number already exists (one per year restriction)
                    const existingPass = allPasses.find(pass => pass.phone === formData.phone);
                    if (existingPass) {
                        showToast('Error', 'Este número de teléfono ya ha sido registrado', 'error');
                        return;
                    }
                    
                    showLoading();
                    
                    try {
                        // Create the pass object with phone as ID
                        const passData = {
                            ...formData,
                            passId: formData.phone,
                            validRange: getBirthdayRangeText(formData.birthDate),
                            registrationDate: new Date().toISOString(),
                            status: 'active',
                            id: Date.now() // Simple ID for demo
                        };
                        
                        // Store in demo data
                        allPasses.push(passData);
                        
                        // Simulate API call - in real implementation, this would be a server request
                        // const response = await fetch('/api/birthday-pass', {
                        //     method: 'POST',
                        //     headers: {
                        //         'Content-Type': 'application/json'
                        //     },
                        //     body: JSON.stringify(formData)
                        // });
                        
                        // For demo purposes, simulate successful response
                        await new Promise(resolve => setTimeout(resolve, 1500));
                        
                        currentPass = passData;
                        displayPassInfo();
                        showConfirmation();
                        showToast('¡Éxito!', 'Registro completado correctamente', 'success');
                        
                    } catch (error) {
                        showToast('Error', error.message || 'Error en el registro', 'error');
                    } finally {
                        hideLoading();
                    }
                });
            }
            
            // Setup logo click handler
            const mainLogo = document.getElementById('main-logo');
            if (mainLogo) {
                mainLogo.addEventListener('click', handleLogoClick);
            }
        });

        // Display pass information
        function displayPassInfo() {
            if (!currentPass) return;
            
            const passDetails = document.getElementById('pass-details');
            
            passDetails.innerHTML = `
                <div><strong>Nombre:</strong> ${currentPass.name}</div>
                <div><strong>Teléfono:</strong> ${currentPass.phone}</div>
                <div><strong>Email:</strong> ${currentPass.email}</div>
                <div><strong>Código de Pase:</strong> ${currentPass.passId}</div>
                <div><strong>Período Válido:</strong> ${currentPass.validRange}</div>
            `;
        }

        // Pass generation functions
        function generateBirthdayPassSVG(passData) {
            const { name, phone, email, passId, validRange, collaboratorCode } = passData;
            
            return `
                <svg width="400" height="600" viewBox="0 0 400 600" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="bgGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#000000;stop-opacity:1" />
                            <stop offset="50%" style="stop-color:#1a1a1a;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#000000;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="accentGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#a855f7;stop-opacity:1" />
                            <stop offset="50%" style="stop-color:#ec4899;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    
                    <rect width="400" height="600" fill="url(#bgGradient)"/>
                    
                    <!-- Logo placeholder -->
                    <rect x="150" y="40" width="100" height="60" fill="#333333" rx="10"/>
                    <text x="200" y="75" text-anchor="middle" fill="white" font-size="12" font-family="Arial, sans-serif">KOKITO</text>
                    
                    <!-- Title -->
                    <rect x="20" y="130" width="360" height="3" fill="url(#accentGradient)"/>
                    <text x="200" y="160" text-anchor="middle" fill="white" font-size="24" font-weight="bold" font-family="Arial, sans-serif">PASE DE CUMPLEAÑOS</text>
                    <text x="200" y="185" text-anchor="middle" fill="#a855f7" font-size="16" font-family="Arial, sans-serif">🎉 TATUAJE GRATIS 🎉</text>
                    
                    <!-- Customer Info -->
                    <rect x="30" y="220" width="340" height="220" fill="rgba(255,255,255,0.05)" stroke="rgba(255,255,255,0.1)" rx="15"/>
                    <text x="50" y="250" fill="#a855f7" font-size="14" font-weight="bold" font-family="Arial, sans-serif">BENEFICIARIO:</text>
                    <text x="50" y="275" fill="white" font-size="16" font-weight="bold" font-family="Arial, sans-serif">${name}</text>
                    
                    <text x="50" y="305" fill="#a855f7" font-size="14" font-weight="bold" font-family="Arial, sans-serif">CÓDIGO DE PASE:</text>
                    <text x="50" y="330" fill="white" font-size="16" font-family="monospace">${passId}</text>
                    
                    <text x="50" y="360" fill="#a855f7" font-size="14" font-weight="bold" font-family="Arial, sans-serif">TELÉFONO:</text>
                    <text x="50" y="385" fill="white" font-size="14" font-family="Arial, sans-serif">${phone}</text>
                    
                    <text x="50" y="415" fill="#a855f7" font-size="14" font-weight="bold" font-family="Arial, sans-serif">PERÍODO VÁLIDO:</text>
                    <text x="50" y="435" fill="white" font-size="12" font-family="Arial, sans-serif">${validRange}</text>
                    
                    <!-- Terms -->
                    <rect x="30" y="460" width="340" height="110" fill="rgba(255,255,255,0.03)" stroke="rgba(255,255,255,0.1)" rx="10"/>
                    <text x="200" y="480" text-anchor="middle" fill="#ec4899" font-size="14" font-weight="bold" font-family="Arial, sans-serif">TÉRMINOS Y CONDICIONES</text>
                    <text x="50" y="495" fill="white" font-size="9" font-family="Arial, sans-serif">• Válido solo en el período indicado arriba</text>
                    <text x="50" y="508" fill="white" font-size="9" font-family="Arial, sans-serif">• Válido únicamente por un tatuaje</text>
                    <text x="50" y="521" fill="white" font-size="9" font-family="Arial, sans-serif">• Pase intransferible</text>
                    <text x="50" y="534" fill="white" font-size="9" font-family="Arial, sans-serif">• Presentar junto con documento de identidad</text>
                    <text x="50" y="547" fill="white" font-size="9" font-family="Arial, sans-serif">• No acumulable con otras promociones</text>
                    <text x="50" y="560" fill="white" font-size="9" font-family="Arial, sans-serif">• Solo válido en Tatuajes Kokito</text>
                    
                    <!-- Footer -->
                    <text x="200" y="585" text-anchor="middle" fill="#666666" font-size="10" font-family="Arial, sans-serif">www.tatuajeskokito.com</text>
                </svg>
            `;
        }

        // Admin functions
        function loadAdminData() {
            if (!isAuthenticated) {
                showStaff();
                return;
            }

            // Load demo data if empty
            if (allPasses.length === 0) {
                loadDemoData();
            }

            updateAdminStats();
            filterPasses('all');
        }

        function loadDemoData() {
            // Add some demo passes for testing
            const demoDate = new Date();
            allPasses = [
                {
                    id: 1,
                    name: 'Juan Pérez',
                    phone: '3001234567',
                    email: 'juan@email.com',
                    passId: '3001234567',
                    status: 'active',
                    validRange: getBirthdayRangeText(demoDate.toISOString().split('T')[0]),
                    registrationDate: new Date().toISOString()
                },
                {
                    id: 2,
                    name: 'María García',
                    phone: '3009876543',
                    email: 'maria@email.com',
                    passId: '3009876543',
                    status: 'redeemed',
                    validRange: getBirthdayRangeText(demoDate.toISOString().split('T')[0]),
                    registrationDate: new Date(Date.now() - 86400000).toISOString()
                },
                {
                    id: 3,
                    name: 'Carlos López',
                    phone: '3005555555',
                    email: 'carlos@email.com',
                    passId: '3005555555',
                    status: 'expired',
                    validRange: '01/01/2024 - 17/01/2024',
                    registrationDate: new Date(Date.now() - 172800000).toISOString()
                }
            ];
        }

        function updateAdminStats() {
            const active = allPasses.filter(p => p.status === 'active').length;
            const redeemed = allPasses.filter(p => p.status === 'redeemed').length;
            const expired = allPasses.filter(p => p.status === 'expired').length;

            document.getElementById('total-active').textContent = active;
            document.getElementById('total-redeemed').textContent = redeemed;
            document.getElementById('total-expired').textContent = expired;
        }

        function filterPasses(status) {
            const passesList = document.getElementById('passes-list');
            let filteredPasses = allPasses;

            if (status !== 'all') {
                filteredPasses = allPasses.filter(p => p.status === status);
            }

            // Update button styles
            document.querySelectorAll('[id^="filter-"]').forEach(btn => {
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-secondary');
            });
            document.getElementById(`filter-${status}`).classList.remove('btn-secondary');
            document.getElementById(`filter-${status}`).classList.add('btn-primary');

            // Display passes
            if (filteredPasses.length === 0) {
                passesList.innerHTML = '<div class="text-center text-gray-400">No hay pases en esta categoría</div>';
                return;
            }

            passesList.innerHTML = filteredPasses.map(pass => {
                const statusColors = {
                    active: 'text-green-400',
                    redeemed: 'text-blue-400',
                    expired: 'text-yellow-400'
                };

                const statusIcons = {
                    active: '✅',
                    redeemed: '✓',
                    expired: '⏰'
                };

                return `
                    <div class="bg-black/20 border border-white/10 rounded-lg p-4">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <div class="font-bold text-white">${pass.name}</div>
                                <div class="text-sm text-gray-400">${pass.phone}</div>
                                <div class="text-xs text-gray-500">${pass.email}</div>
                            </div>
                            <div class="text-right">
                                <div class="${statusColors[pass.status]} font-semibold">
                                    ${statusIcons[pass.status]} ${pass.status.toUpperCase()}
                                </div>
                                <div class="text-xs text-gray-400">ID: ${pass.passId}</div>
                            </div>
                        </div>
                        <div class="text-xs text-gray-400">
                            <div>Válido: ${pass.validRange}</div>
                            <div>Registrado: ${new Date(pass.registrationDate).toLocaleDateString('es-ES')}</div>
                        </div>
                        ${pass.status === 'active' ? `
                            <button onclick="redeemPassFromAdmin('${pass.id}')" class="btn-primary text-xs mt-2 w-full">
                                Canjear Pase
                            </button>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function redeemPassFromAdmin(passId) {
            const pass = allPasses.find(p => p.id == passId);
            if (!pass) return;

            const confirmed = confirm(`¿Confirmas que quieres canjear el pase de ${pass.name}?`);
            if (!confirmed) return;

            pass.status = 'redeemed';
            updateAdminStats();
            filterPasses('all');
            showToast('Éxito', `Pase de ${pass.name} canjeado correctamente`, 'success');
        }

        function exportData() {
            const csvContent = "data:text/csv;charset=utf-8," 
                + "Nombre,Teléfono,Email,Código,Estado,Período Válido,Fecha Registro\n"
                + allPasses.map(pass => 
                    `"${pass.name}","${pass.phone}","${pass.email}","${pass.passId}","${pass.status}","${pass.validRange}","${new Date(pass.registrationDate).toLocaleDateString('es-ES')}"`
                ).join("\n");

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `kokito_pases_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('Éxito', 'Datos exportados correctamente', 'success');
        }

        // Staff functions
        async function loadStats() {
            try {
                // Simulate API call
                // const response = await fetch('/api/stats');
                // if (response.ok) {
                //     const stats = await response.json();
                //     document.getElementById('today-redemptions').textContent = stats.todayRedemptions;
                // }
                
                // For demo purposes
                document.getElementById('today-redemptions').textContent = '0';
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        async function searchPassByPhone() {
            const phone = document.getElementById('search-phone').value.trim();
            
            if (!phone) {
                showToast('Error', 'Ingresa un número de teléfono', 'error');
                return;
            }
            
            showLoading();
            
            try {
                // Simulate API call
                // const response = await fetch(`/api/birthday-pass/phone/${encodeURIComponent(phone)}`);
                // const result = await response.json();
                
                // For demo purposes
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                if (currentPass && currentPass.phone === phone) {
                    displayFoundPass(currentPass);
                } else {
                    throw new Error('Pase no encontrado');
                }
                
            } catch (error) {
                showToast('No encontrado', error.message, 'warning');
                document.getElementById('pass-result').classList.add('hidden');
            } finally {
                hideLoading();
            }
        }

        function displayFoundPass(pass) {
            const customerInfo = document.getElementById('customer-info');
            
            let statusText = '';
            let canRedeem = false;
            
            if (pass.status === 'active') {
                statusText = '<span class="text-green-400">✅ Activo</span>';
                canRedeem = true;
            } else if (pass.status === 'redeemed') {
                statusText = '<span class="text-red-400">❌ Ya canjeado</span>';
            } else {
                statusText = '<span class="text-yellow-400">⚠️ Expirado</span>';
            }
            
            customerInfo.innerHTML = `
                <div class="text-white">
                    <div><strong>Nombre:</strong> ${pass.name}</div>
                    <div><strong>Teléfono:</strong> ${pass.phone}</div>
                    <div><strong>Email:</strong> ${pass.email}</div>
                    <div><strong>Estado:</strong> ${statusText}</div>
                    <div><strong>Período Válido:</strong> ${pass.validRange}</div>
                    <div><strong>Código:</strong> ${pass.passId}</div>
                </div>
            `;
            
            const redeemBtn = document.querySelector('#pass-result button');
            redeemBtn.style.display = canRedeem ? 'block' : 'none';
            redeemBtn.onclick = () => redeemPass(pass.passId);
            
            document.getElementById('pass-result').classList.remove('hidden');
        }

        async function redeemPass(passId) {
            if (!passId) return;
            
            const confirmed = confirm('¿Confirmas que quieres canjear este pase?');
            if (!confirmed) return;
            
            showLoading();
            
            try {
                // Simulate API call
                // const response = await fetch('/api/birthday-pass/redeem', {
                //     method: 'POST',
                //     headers: {
                //         'Content-Type': 'application/json'
                //     },
                //     body: JSON.stringify({ 
                //         passId: passId,
                //         redeemedBy: 'Staff'
                //     })
                // });
                
                // For demo purposes
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                if (currentPass && currentPass.passId === passId) {
                    currentPass.status = 'redeemed';
                }
                
                showToast('¡Éxito!', 'Pase canjeado correctamente', 'success');
                document.getElementById('pass-result').classList.add('hidden');
                document.getElementById('search-phone').value = '';
                loadStats();
                
            } catch (error) {
                showToast('Error', error.message || 'Error al canjear', 'error');
            } finally {
                hideLoading();
            }
        }
    </script>
</body>
</html>
